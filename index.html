<!DOCTYPE html>
<html lang="he">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Finely</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --font-size-base: 16px;
        --font-scale: 1;
        --section-scale: 1;
        --primary-color: #007bff;
        --secondary-color: #6c757d;
        --dark-bg: #1a1a2e;
        --dark-accent: #60a5fa;
      }
      body {
        font-family: "Rubik", sans-serif;
        font-size: calc(var(--font-size-base) * var(--font-scale));
        transition: background-color 0.3s, color 0.3s;
        overflow-x: hidden;
      }
      .container {
        max-width: calc(1000px * var(--section-scale));
        padding: calc(15px * var(--section-scale));
        margin: 0 auto;
      }
      .dark-mode {
        background: linear-gradient(135deg, var(--dark-bg), #16213e) !important;
        color: #fff !important;
      }
      .dark-mode .bg-light,
      .dark-mode .card {
        background: rgba(52, 58, 64, 0.95) !important;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3),
          inset 0 2px 5px rgba(255, 255, 255, 0.1);
      }
      .dark-mode .text-dark,
      .dark-mode .table,
      .dark-mode .form-control,
      .dark-mode .form-select,
      .dark-mode .card,
      .dark-mode .table-bordered,
      .dark-mode .form-control,
      .dark-mode .form-select,
      .dark-mode .btn-outline-secondary,
      .dark-mode .table thead th,
      .dark-mode .btn-outline-primary,
      .dark-mode .btn-nav,
      .dark-mode .footer,
      .dark-mode .category-summary hr {
        border-color: rgba(255, 255, 255, 0.2) !important;
        color: #fff !important;
        background-color: rgba(73, 80, 87, 0.8) !important;
      }
      .dark-mode .btn-outline-primary:hover,
      .dark-mode .btn-nav:hover,
      .dark-mode .btn-nav.active {
        background-color: rgba(96, 165, 250, 0.1);
        color: #3b82f6;
      }
      .offcanvas {
        transition: transform 0.3s;
      }
      .offcanvas-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        font-size: calc(0.9rem * var(--font-scale));
        padding: calc(0.5rem * var(--font-scale)) calc(1rem * var(--font-scale));
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: background-color 0.3s, box-shadow 0.3s;
      }
      .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      }
      .dark-mode .btn-primary,
      .dark-mode .btn-settings {
        background-color: var(--dark-accent);
        border-color: var(--dark-accent);
      }
      .dark-mode .btn-primary:hover,
      .dark-mode .btn-settings:hover {
        background-color: #3b82f6;
        border-color: #3b82f6;
      }
      .btn-primary.position-fixed {
        font-size: calc(1.2rem * var(--font-scale));
        padding: calc(0.4rem * var(--font-scale));
        width: calc(40px * var(--section-scale));
        height: calc(40px * var(--section-scale));
        border-radius: 4px;
        top: calc(10px * var(--section-scale));
        right: calc(10px * var(--section-scale));
        z-index: 1000;
      }
      .btn-nav {
        color: var(--primary-color);
        border: 1px solid transparent;
        border-radius: 4px;
        padding: calc(0.5rem * var(--font-scale)) calc(1rem * var(--font-scale));
        font-size: calc(1rem * var(--font-scale));
        transition: color 0.3s, border-color 0.3s;
        margin: calc(0.5rem * var(--section-scale)) 0;
        display: flex;
        align-items: center;
        gap: calc(8px * var(--section-scale));
      }
      .btn-nav:hover,
      .btn-nav.active {
        color: #0056b3;
        border-color: #007bff;
      }
      .dark-mode .btn-nav,
      .dark-mode .btn-nav:hover,
      .dark-mode .btn-nav.active {
        color: var(--dark-accent);
        border-color: var(--dark-accent);
      }
      .btn-nav .new-badge {
        background: #ff4500;
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: calc(0.8rem * var(--font-scale));
        transform: rotate(15deg);
        transition: transform 0.3s, background-color 0.3s;
      }
      .dark-mode .btn-nav .new-badge {
        background: #ff6347;
      }
      .btn-nav:hover .new-badge {
        transform: rotate(15deg) scale(1.1);
        background: #ff6347;
      }
      .dark-mode .btn-nav:hover .new-badge {
        background: #ff7f50;
      }
      .btn-settings {
        background-color: var(--primary-color);
        color: #fff;
        border-radius: 50%;
        width: calc(45px * var(--section-scale));
        height: calc(45px * var(--section-scale));
        font-size: calc(1.2rem * var(--font-scale));
        transition: background-color 0.3s, transform 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn-settings:hover {
        background-color: #0056b3;
        color: #fff;
        transform: scale(1.1);
      }
      .dark-mode .btn-settings:hover {
        background-color: #3b82f6;
        color: #fff;
      }
      .navbar-buttons {
        display: flex;
        justify-content: center;
        gap: calc(10px * var(--section-scale));
        margin-top: calc(20px * var(--section-scale));
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .chart-container {
        display: flex;
        align-items: center;
        justify-content: center;
        max-width: calc(600px * var(--section-scale));
        margin: 0 auto;
        padding: calc(20px * var(--section-scale)) 0;
      }
      .svg-pie-chart {
        width: calc(300px * var(--section-scale));
        height: calc(300px * var(--section-scale));
        flex-shrink: 0;
      }
      .svg-pie-chart path {
        transition: opacity 0.2s;
      }
      .svg-pie-chart path:hover {
        opacity: 0.8;
      }
      .legend-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: calc(200px * var(--section-scale));
        margin-right: calc(20px * var(--section-scale));
      }
      .legend-item {
        display: flex;
        align-items: center;
        margin: calc(8px * var(--section-scale));
        font-size: calc(16px * var(--font-scale));
      }
      .legend-color {
        width: calc(20px * var(--section-scale));
        height: calc(20px * var(--section-scale));
        margin-left: calc(10px * var(--section-scale));
        border-radius: calc(4px * var(--section-scale));
      }
      .background-svg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.2;
      }
      .background-svg path,
      .background-svg circle,
      .background-svg text {
        stroke: var(--primary-color);
        fill: none;
        stroke-width: 2;
        animation: draw 6s infinite alternate;
      }
      .dark-mode .background-svg path,
      .dark-mode .background-svg circle,
      .dark-mode .background-svg text {
        stroke: var(--dark-accent);
      }
      @keyframes draw {
        0% {
          stroke-dashoffset: 100;
        }
        100% {
          stroke-dashoffset: 0;
        }
      }
      h1 {
        font-weight: 700;
        font-size: calc(2.5rem * var(--font-scale));
        background: linear-gradient(135deg, var(--primary-color), #cc5de8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        animation: pulse 2s infinite;
        text-align: center;
        margin-bottom: calc(2rem * var(--section-scale));
      }
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }
      h2,
      h3,
      h4,
      h5,
      h6 {
        font-weight: 700;
      }
      .category-summary .d-flex {
        padding: calc(4px * var(--section-scale)) 0;
        margin: 0;
        gap: calc(10px * var(--section-scale));
      }
      .category-summary .amount {
        margin-left: calc(10px * var(--section-scale));
      }
      .category-summary hr {
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        margin: calc(8px * var(--section-scale)) 0;
      }
      .collapse-toggle {
        background: none;
        border: none;
        color: inherit;
        font-size: calc(1.2rem * var(--font-scale));
        transition: transform 0.3s;
        width: 100%;
        text-align: end;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .collapse-toggle .bi-chevron-down {
        transition: transform 0.3s;
      }
      .collapse-toggle.collapsed .bi-chevron-down {
        transform: rotate(180deg);
      }
      .toast-container {
        position: fixed;
        top: calc(20px * var(--section-scale));
        right: calc(20px * var(--section-scale));
        z-index: 1055;
      }
      .toast {
        background-color: var(--primary-color);
        color: #fff;
        border: none;
        font-size: calc(14px * var(--font-scale));
      }
      .dark-mode .toast {
        background-color: var(--dark-accent);
      }
      .toast-header strong {
        margin-left: auto;
      }
      .card-header {
        cursor: pointer;
      }
      .table th,
      .table td {
        font-size: calc(14px * var(--font-scale));
        padding: calc(8px * var(--section-scale));
      }
      .modal-content {
        transform: scale(var(--section-scale));
      }
      .footer {
        text-align: center;
        padding: calc(0.5rem * var(--section-scale));
        margin-top: calc(2rem * var(--section-scale));
        font-size: calc(0.9rem * var(--font-scale));
        border-top: 1px solid rgba(0, 0, 0, 0.1);
      }
      .insights-list {
        list-style: none;
        padding: 0;
      }
      .insights-list li {
        padding: calc(0.5rem * var(--font-scale));
        margin-bottom: calc(0.5rem * var(--section-scale));
        background-color: rgba(0, 123, 255, 0.1);
        border-radius: 4px;
        font-size: calc(0.9rem * var(--font-scale));
      }
      .dark-mode .insights-list li {
        background-color: rgba(96, 165, 250, 0.1);
      }
      .monthly-summary .income-text {
        background: #2ecc71;
        color: #fff;
      }
      .dark-mode .monthly-summary .income-text {
        background: #27ae60;
      }
      .monthly-summary .expense-text {
        background: #e74c3c;
        color: #fff;
      }
      .dark-mode .monthly-summary .expense-text {
        background: #c0392b;
      }
      .monthly-summary .balance-text-positive {
        background: #3498db;
        color: #fff;
      }
      .dark-mode .monthly-summary .balance-text-positive {
        background: #2980b9;
      }
      .monthly-summary .balance-text-negative {
        background: #e74c3c;
        color: #fff;
      }
      .dark-mode .monthly-summary .balance-text-negative {
        background: #c0392b;
      }
      .btn-success {
        white-space: nowrap;
      }
      .family-size-container {
        position: fixed;
        top: calc(60px * var(--section-scale));
        left: calc(10px * var(--section-scale));
        width: calc(160px * var(--section-scale));
        transition: transform 0.3s ease-in-out, width 0.3s ease-in-out;
        z-index: 1000;
      }
      .family-size-container.minimized {
        transform: translateX(calc(-150px * var(--section-scale)));
        width: calc(40px * var(--section-scale));
      }
      .family-size-container .card-body {
        padding: calc(10px * var(--section-scale));
        display: contents;
      }
      .family-size-container.minimized .card-body {
        display: none;
      }
      .family-size-container .form-control {
        max-width: calc(100px * var(--section-scale));
        display: inline-block;
      }
      .family-size-container .btn-primary {
        font-size: calc(0.8rem * var(--font-scale));
        padding: calc(0.3rem * var(--font-scale))
          calc(0.6rem * var(--font-scale));
      }
      .family-size-container .row {
        align-items: center;
      }
      .family-size-toggle {
        position: absolute;
        top: calc(10px * var(--section-scale));
        right: calc(-30px * var(--section-scale));
        width: calc(30px * var(--section-scale));
        height: calc(30px * var(--section-scale));
        font-size: calc(0.9rem * var(--font-scale));
        background-color: var(--primary-color);
        color: #fff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s, transform 0.3s;
      }
      .dark-mode .family-size-toggle {
        background-color: var(--dark-accent);
      }
      .family-size-toggle:hover {
        background-color: #0056b3;
        transform: scale(1.1);
      }
      .dark-mode .family-size-toggle:hover {
        background-color: #3b82f6;
      }
    </style>
  </head>
  <body class="bg-light">
    <svg
      class="background-svg"
      viewBox="0 0 1000 1000"
      preserveAspectRatio="xMidYMid slice"
    >
      <path d="M200,300 Q300,200 400,300 T600,300" stroke-dasharray="50,50" />
      <circle cx="300" cy="400" r="20" stroke-dasharray="10,10" />
      <path d="M500,500 Q600,400 700,500 T900,500" stroke-dasharray="30,30" />
      <circle cx="700" cy="600" r="15" stroke-dasharray="5,5" />
      <path
        d="M100,600 L200,700 L300,600 L400,700 L500,600"
        stroke-dasharray="20,20"
      />
      <circle cx="500" cy="300" r="25" stroke-dasharray="15,15" />
      <path
        d="M150,150 L150,250 L200,200 L250,250 L250,150"
        stroke-dasharray="10,10"
      />
      <text
        x="800"
        y="200"
        font-size="40"
        stroke-width="1"
        stroke-dasharray="5,5"
      >
        ₪
      </text>
      <path d="M750,700 Q800,650 850,700 T950,700" stroke-dasharray="40,40" />
    </svg>
    <div id="root" dir="rtl"></div>
    <script>
      const { useState, useEffect, useRef } = React;
      const CollapsibleCard = ({ title, id, children, defaultOpen = true }) =>
        React.createElement(
          "div",
          { className: "card mb-4 bg-light fade-in" },
          React.createElement(
            "button",
            {
              className: "card-header collapse-toggle",
              type: "button",
              "data-bs-toggle": "collapse",
              "data-bs-target": `#${id}`,
              "aria-expanded": defaultOpen,
              "aria-controls": id,
            },
            React.createElement(
              "h2",
              { className: "card-title h5 fw-bold mb-0" },
              title
            ),
            React.createElement("i", { className: "bi bi-chevron-down" })
          ),
          React.createElement(
            "div",
            {
              className: `card-body collapse ${defaultOpen ? "show" : ""}`,
              id,
            },
            children
          )
        );
      const FinanceApp = () => {
        const [state, setState] = useState({
          transactions: [],
          savings: [],
          description: "",
          amount: "",
          type: "הוצאה",
          category: "",
          filterType: "הכל",
          filterCategory: "הכל",
          filterDateStart: "",
          filterDateEnd: "",
          darkMode: true,
          fontSize: "medium",
          error: "",
          savingsName: "",
          savingsAmount: "",
          savingsLocation: "",
          savingsError: "",
          activeTab: "transactions",
          editTransaction: null,
          editDescription: "",
          editAmount: "",
          editType: "הוצאה",
          editCategory: "",
          editError: "",
          familySize: 1,
          minimizedFamilySize: false,
        });
        const savingsChartRef = useRef(null),
          savingsChartInstance = useRef(null);
        const predefinedCategories = [
          "מזון",
          "תחבורה",
          "דיור",
          "בידור",
          "חינוך",
          "בריאות",
          "משכורת",
          "השקעות",
          "מתנות",
          "ביגוד",
          "נסיעות",
          "תקשורת",
          "פנאי",
          "ביטוח",
          "תחזוקה",
          "חשמל",
          "מים",
        ];
        const predefinedLocations = [
          "בנק",
          "קרן פנסיה",
          "תיק השקעות",
          "חשבון חיסכון",
          "מזומן",
        ];
        useEffect(() => {
          const savedData = [
            "transactions",
            "savings",
            "darkMode",
            "fontSize",
            "familySize",
          ].reduce((acc, key) => {
            acc[key] = JSON.parse(
              localStorage.getItem(key) ||
                (key === "darkMode"
                  ? "true"
                  : key === "fontSize"
                  ? '"medium"'
                  : key === "familySize"
                  ? "1"
                  : "[]")
            );
            return acc;
          }, {});
          setState((s) => ({ ...s, ...savedData }));
        }, []);
        useEffect(() => {
          [
            "transactions",
            "savings",
            "darkMode",
            "fontSize",
            "familySize",
          ].forEach((key) =>
            localStorage.setItem(key, JSON.stringify(state[key]))
          );
          document.body.className = state.darkMode
            ? "bg-dark dark-mode"
            : "bg-light";
          document.documentElement.style.setProperty(
            "--font-scale",
            state.fontSize === "small"
              ? 0.8
              : state.fontSize === "large"
              ? 1.2
              : 1
          );
          document.documentElement.style.setProperty(
            "--section-scale",
            state.fontSize === "small"
              ? 0.9
              : state.fontSize === "large"
              ? 1.1
              : 1
          );
        }, [
          state.transactions,
          state.savings,
          state.darkMode,
          state.fontSize,
          state.familySize,
        ]);
        useEffect(() => {
          if (savingsChartRef.current && window.Chart) {
            const ctx = savingsChartRef.current.getContext("2d");
            if (savingsChartInstance.current)
              savingsChartInstance.current.destroy();
            const fontScale =
              parseFloat(
                getComputedStyle(document.documentElement).getPropertyValue(
                  "--font-scale"
                )
              ) || 1;
            savingsChartInstance.current = new window.Chart(ctx, {
              type: "line",
              data: {
                labels: state.savings.map((s) =>
                  new Date(s.date).toLocaleDateString("he-IL")
                ),
                datasets: [
                  {
                    label: "סך החסכונות",
                    data: state.savings.map((s) => s.amount),
                    borderColor: state.darkMode ? "#60a5fa" : "#007bff",
                    backgroundColor: state.darkMode
                      ? "rgba(96,165,250,.2)"
                      : "rgba(0,123,255,.2)",
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: "#fff",
                    pointBorderColor: state.darkMode ? "#60a5fa" : "#007bff",
                    pointHoverRadius: 8,
                  },
                ],
              },
              options: {
                responsive: true,
                scales: {
                  y: {
                    beginAtZero: true,
                    ticks: {
                      color: state.darkMode ? "#fff" : "#212529",
                      font: { size: 12 * fontScale },
                    },
                  },
                  x: {
                    ticks: {
                      color: state.darkMode ? "#fff" : "#212529",
                      font: { size: 12 * fontScale },
                    },
                  },
                },
                plugins: {
                  legend: {
                    labels: {
                      color: state.darkMode ? "#fff" : "#212529",
                      font: { size: 14 * fontScale },
                    },
                  },
                  tooltip: {
                    backgroundColor: state.darkMode ? "#343a40" : "#fff",
                    titleColor: state.darkMode ? "#fff" : "#212529",
                    bodyColor: state.darkMode ? "#fff" : "#212529",
                  },
                },
              },
            });
          }
        }, [state.savings, state.darkMode, state.fontSize]);
        const showToast = (message) => {
          const toastEl = document.createElement("div");
          toastEl.className = "toast";
          toastEl.setAttribute("role", "alert");
          toastEl.setAttribute("aria-live", "assertive");
          toastEl.setAttribute("aria-atomic", "true");
          toastEl.innerHTML = `<div class="toast-header"><button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="סגור"></button><strong class="ms-auto">הודעה</strong></div><div class="toast-body">${message}</div>`;
          document.getElementById("toastContainer").appendChild(toastEl);
          const toast = new bootstrap.Toast(toastEl, {
            autohide: true,
            delay: 3000,
          });
          toast.show();
          toastEl.addEventListener("hidden.bs.toast", () => toastEl.remove());
        };
        const validateForm = (desc, amt, cat, isSavings = false) => {
          if (!desc.trim())
            return isSavings ? "חובה להזין שם חיסכון" : "חובה להזין תיאור";
          if (!amt || isNaN(amt) || parseFloat(amt) <= (isSavings ? -1 : 0))
            return "חובה להזין סכום תקין";
          if (!cat.trim())
            return isSavings ? "חובה לבחור מיקום" : "חובה להזין קטגוריה";
          return "";
        };
        const validateFamilySize = (size) => {
          if (!size || isNaN(size) || parseInt(size) < 1)
            return "חובה להזין מספר בני משפחה תקין (1 או יותר)";
          return "";
        };
        const addTransaction = (e) => {
          e.preventDefault();
          const error = validateForm(
            state.description,
            state.amount,
            state.category
          );
          if (error) return setState((s) => ({ ...s, error }));
          setState((s) => ({
            ...s,
            transactions: [
              ...s.transactions,
              {
                id: Date.now(),
                description: s.description,
                amount: parseFloat(s.amount),
                type: s.type,
                category: s.category,
                date: new Date().toISOString().split("T")[0],
              },
            ],
            description: "",
            amount: "",
            category: "",
            error: "",
          }));
          showToast("פעולה נוספה בהצלחה");
        };
        const addSavings = (e) => {
          e.preventDefault();
          const error = validateForm(
            state.savingsName,
            state.savingsAmount,
            state.savingsLocation,
            true
          );
          if (error) return setState((s) => ({ ...s, savingsError: error }));
          setState((s) => ({
            ...s,
            savings: [
              ...s.savings,
              {
                id: Date.now(),
                name: s.savingsName,
                amount: parseFloat(s.savingsAmount),
                location: s.savingsLocation,
                date: new Date().toISOString().split("T")[0],
              },
            ],
            savingsName: "",
            savingsAmount: "",
            savingsLocation: "",
            savingsError: "",
          }));
          showToast("חיסכון נוסף בהצלחה");
        };
        const updateFamilySize = (e) => {
          e.preventDefault();
          const error = validateFamilySize(state.familySize);
          if (error) return showToast(error);
          setState((s) => ({ ...s }));
          showToast("מספר בני המשפחה עודכן בהצלחה");
        };
        const toggleFamilySize = () =>
          setState((s) => ({
            ...s,
            minimizedFamilySize: !s.minimizedFamilySize,
          }));
        const deleteTransaction = (id) => {
          setState((s) => ({
            ...s,
            transactions: s.transactions.filter((t) => t.id !== id),
          }));
          showToast("פעולה נמחקה בהצלחה");
        };
        const deleteSavings = (id) => {
          setState((s) => ({
            ...s,
            savings: s.savings.filter((s) => s.id !== id),
          }));
          showToast("חיסכון נמחק בהצלחה");
        };
        const openEditModal = (transaction) => {
          setState((s) => ({
            ...s,
            editTransaction: transaction,
            editDescription: transaction.description,
            editAmount: transaction.amount.toString(),
            editType: transaction.type,
            editCategory: transaction.category,
            editError: "",
          }));
          new bootstrap.Modal(
            document.getElementById("editTransactionModal")
          ).show();
        };
        const editTransactionSubmit = (e) => {
          e.preventDefault();
          const error = validateForm(
            state.editDescription,
            state.editAmount,
            state.editCategory
          );
          if (error) return setState((s) => ({ ...s, editError: error }));
          setState((s) => ({
            ...s,
            transactions: s.transactions.map((t) =>
              t.id === s.editTransaction.id
                ? {
                    ...t,
                    description: s.editDescription,
                    amount: parseFloat(s.editAmount),
                    type: s.editType,
                    category: s.editCategory,
                  }
                : t
            ),
            editTransaction: null,
            editDescription: "",
            editAmount: "",
            editType: "הוצאה",
            editCategory: "",
            editError: "",
          }));
          showToast("פעולה עודכנה בהצלחה");
          bootstrap.Modal.getInstance(
            document.getElementById("editTransactionModal")
          ).hide();
        };
        const openSettingsModal = () =>
          new bootstrap.Modal(document.getElementById("settingsModal")).show();
        const filteredTransactions = state.transactions.filter((t) => {
          const date = new Date(t.date);
          return (
            (state.filterType === "הכל" || t.type === state.filterType) &&
            (state.filterCategory === "הכל" ||
              t.category === state.filterCategory) &&
            (!state.filterDateStart ||
              date >= new Date(state.filterDateStart)) &&
            (!state.filterDateEnd || date <= new Date(state.filterDateEnd))
          );
        });
        const totalIncome = filteredTransactions
          .filter((t) => t.type === "הכנסה")
          .reduce((sum, t) => sum + t.amount, 0);
        const totalExpenses = filteredTransactions
          .filter((t) => t.type === "הוצאה")
          .reduce((sum, t) => sum + t.amount, 0);
        const balance = totalIncome - totalExpenses;
        const categorySummary = filteredTransactions.reduce(
          (acc, t) => ({
            ...acc,
            [t.category]:
              (acc[t.category] || 0) +
              (t.type === "הכנסה" ? t.amount : -t.amount),
          }),
          {}
        );
        const categoryData = predefinedCategories.reduce((acc, cat) => {
          const total = filteredTransactions
            .filter((t) => t.category === cat && t.type === "הוצאה")
            .reduce((sum, t) => sum + t.amount, 0);
          if (total > 0) acc[cat] = total;
          return acc;
        }, {});
        const totalCategoryAmount = Object.values(categoryData).reduce(
          (sum, val) => sum + val,
          0
        );
        const pieChartData = Object.entries(categoryData).map(
          ([category, amount], i) => ({
            category,
            amount,
            color: state.darkMode
              ? [
                  "#ff6b6b",
                  "#4dabf7",
                  "#51cf66",
                  "#ff922b",
                  "#cc5de8",
                  "#339af0",
                  "#fab005",
                  "#868e96",
                  "#20c997",
                  "#f06595",
                  "#845ef7",
                  "#2b8a3e",
                  "#e03131",
                  "#364fc7",
                  "#f08c00",
                  "#087f5b",
                ][i % 16]
              : [
                  "#007bff",
                  "#6c757d",
                  "#51cf66",
                  "#ff922b",
                  "#cc5de8",
                  "#339af0",
                  "#fab005",
                  "#6c757d",
                  "#20c997",
                  "#f06595",
                  "#845ef7",
                  "#2b8a3e",
                  "#e03131",
                  "#364fc7",
                  "#f08c00",
                  "#087f5b",
                ][i % 16],
          })
        );
        const generatePieChart = () =>
          totalCategoryAmount
            ? React.createElement(
                "div",
                { className: "chart-container" },
                React.createElement(
                  "svg",
                  { className: "svg-pie-chart", viewBox: "0 0 300 300" },
                  pieChartData.reduce(
                    (acc, { category, amount, color }, i, arr) => {
                      const percentage = (amount / totalCategoryAmount) * 360;
                      const startAngle = acc.start || 0;
                      const endAngle = startAngle + percentage;
                      const largeArc = percentage > 180 ? 1 : 0;
                      const startX =
                        150 + 100 * Math.cos((startAngle * Math.PI) / 180);
                      const startY =
                        150 + 100 * Math.sin((startAngle * Math.PI) / 180);
                      const endX =
                        150 + 100 * Math.cos((endAngle * Math.PI) / 180);
                      const endY =
                        150 + 100 * Math.sin((endAngle * Math.PI) / 180);
                      acc.paths.push(
                        React.createElement("path", {
                          key: category,
                          d: `M150,150 L${startX},${startY} A100,100 0 ${largeArc},1 ${endX},${endY} Z`,
                          fill: color,
                          onMouseOver: (e) => {
                            e.target.setAttribute("opacity", "0.8");
                            const tooltip = document.createElement("div");
                            tooltip.innerText = `${category}: ${amount.toFixed(
                              2
                            )} ₪`;
                            tooltip.style.cssText = `position:absolute;background:${
                              state.darkMode ? "#343a40" : "#fff"
                            };color:${
                              state.darkMode ? "#fff" : "#212529"
                            };padding:5px 10px;border-radius:5px;box-shadow:0 2px 5px rgba(0,0,0,.2);left:${
                              e.pageX + 10
                            }px;top:${e.pageY + 10}px`;
                            document.body.appendChild(tooltip);
                          },
                          onMouseOut: (e) => {
                            e.target.setAttribute("opacity", "1");
                            document
                              .querySelectorAll(
                                'div[style*="position: absolute"]'
                              )
                              .forEach((el) => el.remove());
                          },
                        })
                      );
                      acc.start = endAngle;
                      return acc;
                    },
                    { paths: [], start: 0 }
                  ).paths
                ),
                React.createElement(
                  "div",
                  { className: "legend-container" },
                  pieChartData.map(({ category, color }) =>
                    React.createElement(
                      "div",
                      { key: category, className: "legend-item" },
                      React.createElement("div", {
                        className: "legend-color",
                        style: { backgroundColor: color },
                      }),
                      React.createElement("span", null, category)
                    )
                  )
                )
              )
            : React.createElement(
                "div",
                { className: "text-center text-muted" },
                "אין נתונים להצגה"
              );
        const monthlySummary = filteredTransactions.reduce((acc, t) => {
          const date = new Date(t.date);
          if (isNaN(date.getTime())) return acc;
          const month = date.toLocaleString("he-IL", {
            month: "long",
            year: "numeric",
          });
          acc[month] = acc[month] || { income: 0, expenses: 0 };
          acc[month][t.type === "הכנסה" ? "income" : "expenses"] += t.amount;
          return acc;
        }, {});
        const totalSavings = state.savings.reduce(
          (sum, s) => sum + s.amount,
          0
        );
        const previousSavings = state.savings
          .slice(0, -1)
          .reduce((sum, s) => sum + s.amount, 0);
        const savingsChange =
          state.savings.length > 1
            ? (
                ((totalSavings - previousSavings) / previousSavings) *
                100
              ).toFixed(2)
            : 0;
        const generateInsights = () => {
          const insights = [];
          const expenseCategories = filteredTransactions
            .filter((t) => t.type === "הוצאה")
            .reduce(
              (acc, t) => ({
                ...acc,
                [t.category]: (acc[t.category] || 0) + t.amount,
              }),
              {}
            );
          const topCategory = Object.entries(expenseCategories).reduce(
            (max, [cat, amount]) =>
              amount > (max.amount || 0) ? { category: cat, amount } : max,
            {}
          );
          if (topCategory.category)
            insights.push(
              `הקטגוריה עם ההוצאה הגבוהה ביותר היא "${
                topCategory.category
              }" עם סך של ${topCategory.amount.toFixed(
                2
              )} ₪. שקול לבדוק אפשרויות לחיסכון בקטגוריה זו, כמו השוואת מחירים או צמצום הוצאות לא הכרחיות.`
            );
          if (balance < 0)
            insights.push(
              `המאזן שלך שלילי (${balance.toFixed(
                2
              )} ₪). מומלץ להפחית הוצאות או להגדיל הכנסות, כמו חיפוש מקורות הכנסה נוספים, כדי לשפר את המצב הפיננסי.`
            );
          else if (balance < totalExpenses * 0.1)
            insights.push(
              `המאזן שלך (${balance.toFixed(
                2
              )} ₪) נמוך יחסית להוצאות (${totalExpenses.toFixed(
                2
              )} ₪). שקול להגדיר תקציב חודשי להוצאות, לדוגמה לפי חוק 50/30/20 (50% צרכים, 30% רצונות, 20% חסכונות).`
            );
          else
            insights.push(
              `המאזן שלך חיובי (${balance.toFixed(
                2
              )} ₪). כל הכבוד! המשך לנהל את הכספים שלך בחוכמה והשקע עודפים בחסכונות או השקעות.`
            );
          if (totalSavings === 0)
            insights.push(
              "לא נרשמו חסכונות. מומלץ להתחיל להפריש סכומים לחיסכון, כגון קרן חירום השווה ל-3 עד 6 חודשי הוצאות, לעתיד יציב יותר."
            );
          else if (savingsChange < 0)
            insights.push(
              `החסכונות שלך ירדו ב-${Math.abs(
                savingsChange
              )}%. בדוק אם יש הוצאות בלתי צפויות שמשפיעות על החסכונות והערך אפשרויות להפחתתן.`
            );
          else if (savingsChange > 0)
            insights.push(
              `החסכונות שלך גדלו ב-${savingsChange}%! המשך להגדיל את החסכונות שלך על ידי הפרשות קבועות, ושקול אפשרויות השקעה לטווח ארוך.`
            );
          else
            insights.push(
              `החסכונות שלך נשארו ללא שינוי (${totalSavings.toFixed(
                2
              )} ₪). שקול להגדיל את ההפרשות החודשיות לחסכונות, אפילו בסכומים קטנים, כדי לבנות עתיד פיננסי חזק יותר.`
            );
          const savingsByLocation = state.savings.reduce(
            (acc, s) => ({
              ...acc,
              [s.location]: (acc[s.location] || 0) + s.amount,
            }),
            {}
          );
          const dominantLocation = Object.entries(savingsByLocation).reduce(
            (max, [loc, amount]) =>
              amount > (max.amount || 0) ? { location: loc, amount } : max,
            {}
          );
          if (
            dominantLocation.location &&
            dominantLocation.amount / totalSavings > 0.7
          )
            insights.push(
              `רוב החסכונות שלך (${(
                (dominantLocation.amount / totalSavings) *
                100
              ).toFixed(1)}%) נמצאים ב"${
                dominantLocation.location
              }". שקול לגוון את החסכונות שלך, כגון השקעה בקרנות נאמנות או חשבונות חיסכון מגוונים, כדי להפחית סיכונים.`
            );
          const monthlyExpenses =
            Object.values(monthlySummary).reduce(
              (sum, m) => sum + m.expenses,
              0
            ) / Object.keys(monthlySummary).length;
          if (monthlyExpenses > totalIncome * 0.5 && monthlyExpenses > 0)
            insights.push(
              `ההוצאות החודשיות הממוצעות שלך (${monthlyExpenses.toFixed(
                2
              )} ₪) מהוות יותר מ-50% מההכנסות. נסה ליישם תקציב 50/30/20 כדי להקצות 50% לצרכים, 30% לרצונות ו-20% לחסכונות.`
            );
          const transactionFrequency = filteredTransactions.reduce((acc, t) => {
            const date = new Date(t.date).toLocaleDateString("he-IL");
            acc[date] = (acc[date] || 0) + 1;
            return acc;
          }, {});
          const highFrequencyDays = Object.entries(transactionFrequency).filter(
            ([_, count]) => count > 5
          );
          if (highFrequencyDays.length > 0)
            insights.push(
              `זוהו ימים עם פעילות גבוהה של הוצאות (${highFrequencyDays
                .map(([date]) => date)
                .join(
                  ", "
                )}). בדוק אם יש הוצאות קטנות ותכופות, כמו קפה או אוכל בחוץ, ונסה לצמצם אותם.`
            );
          const smallExpenses = filteredTransactions.filter(
            (t) => t.type === "הוצאה" && t.amount < 50
          ).length;
          if (
            smallExpenses > filteredTransactions.length * 0.3 &&
            smallExpenses > 0
          )
            insights.push(
              `יותר מ-30% מההוצאות שלך (${smallExpenses} פעולות) הן הוצאות קטנות (מתחת ל-50 ₪). שקול להפחית רכישות קטנות, כמו ארוחות קלות או חטיפות, כדי להגדיל את החסכונות.`
            );
          const hasEmergencyFund = state.savings.some(
            (s) =>
              s.name.toLowerCase().includes("חירום") ||
              s.name.toLowerCase().includes("מיוחד")
          );
          if (!hasEmergencyFund && totalSavings < totalExpenses * 3)
            insights.push(
              `לא זוהתה קרן חירום. מומלץ להפריש סכום השווה ל-3 עד 6 חודשי הוצאות (${(
                totalExpenses * 3
              ).toFixed(2)} ₪ עד ${(totalExpenses * 6).toFixed(
                2
              )} ₪) לחשבון חירום נפרד.`
            );
          if (
            totalIncome > totalExpenses * 1.5 &&
            totalSavings < totalIncome * 0.2
          )
            insights.push(
              `ההכנסות שלך (${totalIncome.toFixed(
                2
              )} ₪) מאפשרות חיסכון משמעותי יותר. שקול להגדיל את ההפרשות החודשיות לחסכונות ל-20% מההכנסה (${(
                totalIncome * 0.2
              ).toFixed(2)} ₪) כדי לבנות עתודה פיננסית.`
            );
          if (state.familySize > 0) {
            const perPersonExpenses = totalExpenses / state.familySize;
            if (perPersonExpenses > 2000)
              insights.push(
                `ההוצאה הממוצעת לבן משפחה היא ${perPersonExpenses.toFixed(
                  2
                )} ₪ לחודש. זה גבוה מהממוצע למשפחה בת ${
                  state.familySize
                } נפשות. שקול לבדוק הוצאות על צרכים בסיסיים כמו מזון ודיור כדי למצוא דרכים לחסוך.`
              );
            else
              insights.push(
                `ההוצאה הממוצעת לבן משפחה היא ${perPersonExpenses.toFixed(
                  2
                )} ₪ לחודש, שמתאימה למשפחה בת ${
                  state.familySize
                } נפשות. המשך לנטר הוצאות כדי לשמור על תקציב מאוזן.`
              );
            if (state.familySize >= 4 && totalSavings < totalExpenses * 4)
              insights.push(
                `למשפחה בת ${
                  state.familySize
                } נפשות, מומלץ להחזיק קרן חירום של לפחות 4 חודשי הוצאות (${(
                  totalExpenses * 4
                ).toFixed(2)} ₪). שקול להגדיל את החסכונות שלך בהתאם.`
              );
            if (
              expenseCategories["מזון"] &&
              expenseCategories["מזון"] / state.familySize > 1000
            )
              insights.push(
                `הוצאות המזון שלך (${(
                  expenseCategories["מזון"] / state.familySize
                ).toFixed(2)} ₪ לנפש) גבוהות עבור משפחה בת ${
                  state.familySize
                } נפשות. שקול לתכנן ארוחות מראש או לקנות בכמויות גדולות כדי להפחית עלויות.`
              );
            if (
              expenseCategories["דיור"] &&
              expenseCategories["דיור"] / state.familySize > 1500
            )
              insights.push(
                `הוצאות הדיור שלך (${(
                  expenseCategories["דיור"] / state.familySize
                ).toFixed(2)} ₪ לנפש) גבוהות עבור משפחה בת ${
                  state.familySize
                } נפשות. בדוק אפשרויות למשכנתא זולה יותר או צמצום עלויות תחזוקה.`
              );
          }
          return insights.length
            ? insights
            : [
                "אין מספיק נתונים כדי לספק תובנות. הוסף פעולות, חסכונות ומספר בני משפחה לקבלת המלצות מותאמות.",
              ];
        };
        const exportToCSV = () => {
          const csv =
            "תיאור,סכום,סוג,קטגוריה,תאריך\n" +
            filteredTransactions
              .map(
                (t) =>
                  `"${t.description}",${t.amount},"${t.type}","${
                    t.category
                  }","${new Date(t.date).toLocaleDateString("he-IL")}"`
              )
              .join("\n");
          const blob = new Blob([new Uint8Array([0xef, 0xbb, 0xbf]), csv], {
            type: "text/csv;charset=utf-8",
          });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = "transactions.csv";
          link.click();
          URL.revokeObjectURL(link.href);
        };
        const FormField = ({
          type,
          placeholder,
          value,
          onChange,
          options,
          isSelect,
        }) =>
          isSelect
            ? React.createElement(
                "select",
                { value, onChange, className: "form-select" },
                React.createElement("option", { value: "" }, placeholder),
                options.map((opt) =>
                  React.createElement("option", { key: opt, value: opt }, opt)
                )
              )
            : React.createElement("input", {
                type,
                placeholder,
                value,
                onChange,
                className: "form-control",
              });
        return React.createElement(
          "div",
          { className: "container my-4" },
          React.createElement("div", {
            id: "toastContainer",
            className: "toast-container",
          }),
          React.createElement(
            "div",
            {
              className: "modal fade",
              id: "editTransactionModal",
              tabIndex: "-1",
              "aria-labelledby": "editTransactionModalLabel",
              "aria-hidden": "true",
            },
            React.createElement(
              "div",
              { className: "modal-dialog" },
              React.createElement(
                "div",
                { className: "modal-content" },
                React.createElement(
                  "div",
                  { className: "modal-header" },
                  React.createElement(
                    "h5",
                    {
                      className: "modal-title fw-bold",
                      id: "editTransactionModalLabel",
                    },
                    "עריכת פעולה"
                  ),
                  React.createElement("button", {
                    type: "button",
                    className: "btn-close",
                    "data-bs-dismiss": "modal",
                    "aria-label": "סגור",
                  })
                ),
                React.createElement(
                  "div",
                  { className: "modal-body" },
                  state.editError &&
                    React.createElement(
                      "p",
                      { className: "text-danger mb-3" },
                      state.editError
                    ),
                  React.createElement(
                    "div",
                    { className: "row g-3" },
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        type: "text",
                        placeholder: "תיאור",
                        value: state.editDescription,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            editDescription: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        type: "number",
                        placeholder: "סכום",
                        value: state.editAmount,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            editAmount: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        isSelect: true,
                        value: state.editType,
                        onChange: (e) =>
                          setState((s) => ({ ...s, editType: e.target.value })),
                        options: ["הוצאה", "הכנסה"],
                        placeholder: "בחר סוג",
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        isSelect: true,
                        value: state.editCategory,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            editCategory: e.target.value,
                          })),
                        options: predefinedCategories,
                        placeholder: "בחר קטגוריה",
                      })
                    )
                  )
                ),
                React.createElement(
                  "div",
                  { className: "modal-footer" },
                  React.createElement(
                    "button",
                    {
                      type: "button",
                      className: "btn btn-outline-secondary",
                      "data-bs-dismiss": "modal",
                    },
                    "ביטול"
                  ),
                  React.createElement(
                    "button",
                    {
                      type: "button",
                      className: "btn btn-primary",
                      onClick: editTransactionSubmit,
                    },
                    "שמור שינויים"
                  )
                )
              )
            )
          ),
          React.createElement(
            "div",
            {
              className: "modal fade",
              id: "settingsModal",
              tabIndex: "-1",
              "aria-labelledby": "settingsModalLabel",
              "aria-hidden": "true",
            },
            React.createElement(
              "div",
              { className: "modal-dialog" },
              React.createElement(
                "div",
                { className: "modal-content" },
                React.createElement(
                  "div",
                  { className: "modal-header" },
                  React.createElement(
                    "h5",
                    {
                      className: "modal-title fw-bold",
                      id: "settingsModalLabel",
                    },
                    "הגדרות"
                  ),
                  React.createElement("button", {
                    type: "button",
                    className: "btn-close",
                    "data-bs-dismiss": "modal",
                    "aria-label": "סגור",
                  })
                ),
                React.createElement(
                  "div",
                  { className: "modal-body" },
                  React.createElement(
                    "div",
                    { className: "mb-3" },
                    React.createElement(
                      "label",
                      { className: "form-label fw-bold" },
                      "גודל טקסט ותוכן"
                    ),
                    React.createElement(
                      "select",
                      {
                        value: state.fontSize,
                        onChange: (e) =>
                          setState((s) => ({ ...s, fontSize: e.target.value })),
                        className: "form-select",
                      },
                      ["small", "medium", "large"].map((size) =>
                        React.createElement(
                          "option",
                          { key: size, value: size },
                          size === "small"
                            ? "קטן"
                            : size === "medium"
                            ? "בינוני"
                            : "גדול"
                        )
                      )
                    )
                  )
                ),
                React.createElement(
                  "div",
                  { className: "modal-footer" },
                  React.createElement(
                    "button",
                    {
                      type: "button",
                      className: "btn btn-outline-secondary",
                      "data-bs-dismiss": "modal",
                    },
                    "סגור"
                  )
                )
              )
            )
          ),
          React.createElement(
            "button",
            {
              className: "btn btn-primary position-fixed top-0 end-0 m-3",
              type: "button",
              "data-bs-toggle": "offcanvas",
              "data-bs-target": "#offcanvasSidebar",
              "aria-controls": "offcanvasSidebar",
            },
            "☰"
          ),
          React.createElement(
            "div",
            {
              className: "offcanvas offcanvas-end bg-light",
              tabIndex: "-1",
              id: "offcanvasSidebar",
              "aria-labelledby": "offcanvasSidebarLabel",
            },
            React.createElement(
              "div",
              { className: "offcanvas-header" },
              React.createElement(
                "h5",
                {
                  className: "offcanvas-title fw-bold",
                  id: "offcanvasSidebarLabel",
                },
                "תפריט"
              ),
              React.createElement("button", {
                type: "button",
                className: "btn-close",
                "data-bs-dismiss": "offcanvas",
                "aria-label": "סגור",
              })
            ),
            React.createElement(
              "div",
              { className: "offcanvas-body" },
              React.createElement(
                "nav",
                { className: "nav flex-column gap-3" },
                ["transactions", "savings", "insights", "about"].map((tab) =>
                  React.createElement(
                    "a",
                    {
                      key: tab,
                      className: `nav-link btn-nav ${
                        state.activeTab === tab ? "active" : ""
                      }`,
                      href: "#",
                      onClick: (e) => {
                        e.preventDefault();
                        setState((s) => ({ ...s, activeTab: tab }));
                      },
                    },
                    tab === "insights"
                      ? React.createElement(
                          "span",
                          { className: "new-badge" },
                          "חדש!"
                        )
                      : null,
                    tab === "transactions"
                      ? "פעולות"
                      : tab === "savings"
                      ? "חסכונות"
                      : tab === "insights"
                      ? "תובנות"
                      : "אודות"
                  )
                )
              ),
              React.createElement(
                "div",
                { className: "navbar-buttons" },
                React.createElement(
                  "button",
                  {
                    className: "btn btn-settings",
                    onClick: openSettingsModal,
                    title: "הגדרות",
                  },
                  React.createElement("i", { className: "bi bi-gear-fill" })
                ),
                React.createElement(
                  "button",
                  {
                    className: "btn btn-settings",
                    onClick: () =>
                      setState((s) => ({ ...s, darkMode: !s.darkMode })),
                    title: state.darkMode ? "מצב יום" : "מצב לילה",
                  },
                  state.darkMode ? "☀️" : "🌙"
                )
              )
            )
          ),
          state.activeTab === "transactions" &&
            React.createElement(
              "div",
              {
                className: `family-size-container ${
                  state.minimizedFamilySize ? "minimized" : ""
                }`,
              },
              React.createElement(
                "div",
                { className: "card bg-light fade-in" },
                React.createElement(
                  "button",
                  {
                    className: "family-size-toggle",
                    onClick: toggleFamilySize,
                    title: state.minimizedFamilySize ? "הצג" : "מזער",
                  },
                  React.createElement("i", {
                    className: `bi ${
                      state.minimizedFamilySize
                        ? "bi-chevron-right"
                        : "bi-chevron-left"
                    }`,
                  })
                ),
                React.createElement(
                  "div",
                  { className: "card-body" },
                  React.createElement(
                    "h5",
                    { className: "fw-bold mb-3" },
                    "כמות נפשות"
                  ),
                  React.createElement(
                    "div",
                    { className: "row g-2" },
                    React.createElement(
                      "div",
                      { className: "col-auto" },
                      FormField({
                        type: "number",
                        placeholder: "מספר נפשות",
                        value: state.familySize,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            familySize: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-auto" },
                      React.createElement(
                        "button",
                        {
                          onClick: updateFamilySize,
                          className: "btn btn-primary",
                        },
                        "שמור"
                      )
                    )
                  )
                )
              )
            ),
          React.createElement("h1", { className: "fade-in" }, "Finely"),
          state.activeTab === "transactions" &&
            React.createElement(
              React.Fragment,
              null,
              CollapsibleCard({
                title: "הוספת פעולה",
                id: "transactionFormCollapse",
                children: React.createElement(
                  React.Fragment,
                  null,
                  state.error &&
                    React.createElement(
                      "p",
                      { className: "text-danger mb-3" },
                      state.error
                    ),
                  React.createElement(
                    "div",
                    { className: "row g-3" },
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        type: "text",
                        placeholder: "תיאור",
                        value: state.description,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            description: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        type: "number",
                        placeholder: "סכום",
                        value: state.amount,
                        onChange: (e) =>
                          setState((s) => ({ ...s, amount: e.target.value })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        isSelect: true,
                        value: state.type,
                        onChange: (e) =>
                          setState((s) => ({ ...s, type: e.target.value })),
                        options: ["הוצאה", "הכנסה"],
                        placeholder: "בחר סוג",
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-6" },
                      FormField({
                        isSelect: true,
                        value: state.category,
                        onChange: (e) =>
                          setState((s) => ({ ...s, category: e.target.value })),
                        options: predefinedCategories,
                        placeholder: "בחר קטגוריה",
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-12" },
                      React.createElement(
                        "button",
                        {
                          onClick: addTransaction,
                          className: "btn btn-primary w-100",
                        },
                        "הוסף פעולה"
                      )
                    )
                  )
                ),
              }),
              CollapsibleCard({
                title: "סינון פעולות",
                id: "filtersCollapse",
                children: React.createElement(
                  "div",
                  { className: "row g-3" },
                  React.createElement(
                    "div",
                    { className: "col-md-3" },
                    FormField({
                      isSelect: true,
                      value: state.filterType,
                      onChange: (e) =>
                        setState((s) => ({ ...s, filterType: e.target.value })),
                      options: ["הכל", "הוצאה", "הכנסה"],
                      placeholder: "הכל",
                    })
                  ),
                  React.createElement(
                    "div",
                    { className: "col-md-3" },
                    FormField({
                      isSelect: true,
                      value: state.filterCategory,
                      onChange: (e) =>
                        setState((s) => ({
                          ...s,
                          filterCategory: e.target.value,
                        })),
                      options: ["הכל", ...predefinedCategories],
                      placeholder: "כל הקטגוריות",
                    })
                  ),
                  React.createElement(
                    "div",
                    { className: "col-md-6" },
                    React.createElement(
                      "div",
                      { className: "row g-3" },
                      React.createElement(
                        "div",
                        { className: "col-md-6" },
                        FormField({
                          type: "date",
                          value: state.filterDateStart,
                          onChange: (e) =>
                            setState((s) => ({
                              ...s,
                              filterDateStart: e.target.value,
                            })),
                        })
                      ),
                      React.createElement(
                        "div",
                        { className: "col-md-6" },
                        FormField({
                          type: "date",
                          value: state.filterDateEnd,
                          onChange: (e) =>
                            setState((s) => ({
                              ...s,
                              filterDateEnd: e.target.value,
                            })),
                        })
                      )
                    )
                  )
                ),
              }),
              CollapsibleCard({
                title: "סיכום",
                id: "summaryCollapse",
                children: React.createElement(
                  "div",
                  { className: "row g-3" },
                  [
                    {
                      title: "הכנסות",
                      amount: totalIncome,
                      color: state.darkMode ? "27ae60" : "2ecc71",
                    },
                    {
                      title: "הוצאות",
                      amount: totalExpenses,
                      color: state.darkMode ? "c0392b" : "e74c3c",
                    },
                    {
                      title: "מאזן",
                      amount: balance,
                      color:
                        balance >= 0
                          ? state.darkMode
                            ? "2980b9"
                            : "3498db"
                          : state.darkMode
                          ? "c0392b"
                          : "e74c3c",
                    },
                  ].map(({ title, amount, color }) =>
                    React.createElement(
                      "div",
                      { key: title, className: "col-md-4" },
                      React.createElement(
                        "div",
                        { className: `card bg-${color} text-white` },
                        React.createElement(
                          "div",
                          { className: "card-body" },
                          React.createElement(
                            "h3",
                            { className: "card-title h6 fw-bold" },
                            title
                          ),
                          React.createElement(
                            "p",
                            { className: "card-text fs-5" },
                            amount.toFixed(2) + " ₪"
                          )
                        )
                      )
                    )
                  )
                ),
              }),
              CollapsibleCard({
                title: "פילוח הוצאות לפי קטגוריה",
                id: "pieChartCollapse",
                children: generatePieChart(),
              }),
              CollapsibleCard({
                title: "סיכום חודשי",
                id: "monthlySummaryCollapse",
                children: React.createElement(
                  "div",
                  { className: "row g-3" },
                  Object.entries(monthlySummary).map(([month, data]) =>
                    React.createElement(
                      "div",
                      { key: month, className: "col-md-4" },
                      React.createElement(
                        "div",
                        { className: "card bg-light" },
                        React.createElement(
                          "div",
                          { className: "card-body" },
                          React.createElement(
                            "h3",
                            { className: "card-title h6 fw-bold" },
                            month
                          ),
                          React.createElement(
                            "p",
                            { className: "card-text income-text" },
                            `הכנסות: ${data.income.toFixed(2)} ₪`
                          ),
                          React.createElement(
                            "p",
                            { className: "card-text expense-text" },
                            `הוצאות: ${data.expenses.toFixed(2)} ₪`
                          ),
                          React.createElement(
                            "p",
                            {
                              className: `card-text ${
                                data.income - data.expenses >= 0
                                  ? "balance-text-positive"
                                  : "balance-text-negative"
                              }`,
                            },
                            `מאזן: ${(data.income - data.expenses).toFixed(
                              2
                            )} ₪`
                          )
                        )
                      )
                    )
                  )
                ),
              }),
              CollapsibleCard({
                title: "סיכום לפי קטגוריה",
                id: "categorySummaryCollapse",
                children: React.createElement(
                  "div",
                  { className: "row g-3" },
                  Object.entries(categorySummary).map(([cat, amount], i, arr) =>
                    React.createElement(
                      "div",
                      { key: cat, className: "col-md-6" },
                      React.createElement(
                        "div",
                        { className: "d-flex align-items-center" },
                        React.createElement(
                          "span",
                          { className: "fw-bold" },
                          cat
                        ),
                        React.createElement(
                          "span",
                          {
                            className: `amount ${
                              amount >= 0 ? "text-success" : "text-danger"
                            }`,
                          },
                          amount.toFixed(2) + " ₪"
                        )
                      ),
                      i < arr.length - 1 && React.createElement("hr", null)
                    )
                  )
                ),
              }),
              React.createElement(
                "div",
                { className: "card bg-light fade-in" },
                React.createElement(
                  "div",
                  {
                    className:
                      "card-header d-flex justify-content-between align-items-center",
                  },
                  React.createElement(
                    "button",
                    {
                      className: "collapse-toggle",
                      type: "button",
                      "data-bs-toggle": "collapse",
                      "data-bs-target": "#transactionsTableCollapse",
                      "aria-expanded": "true",
                      "aria-controls": "transactionsTableCollapse",
                    },
                    React.createElement(
                      "h2",
                      { className: "card-title h5 fw-bold mb-0" },
                      "רשימת פעולות"
                    ),
                    React.createElement("i", {
                      className: "bi bi-chevron-down",
                    })
                  ),
                  React.createElement(
                    "button",
                    { onClick: exportToCSV, className: "btn btn-success" },
                    "יצוא ל-CSV"
                  )
                ),
                React.createElement(
                  "div",
                  {
                    className: "card-body collapse show",
                    id: "transactionsTableCollapse",
                  },
                  React.createElement(
                    "div",
                    { className: "table-responsive" },
                    React.createElement(
                      "table",
                      { className: "table table-bordered" },
                      React.createElement(
                        "thead",
                        null,
                        React.createElement(
                          "tr",
                          null,
                          [
                            "תיאור",
                            "סכום",
                            "סוג",
                            "קטגוריה",
                            "תאריך",
                            "פעולות",
                          ].map((h) => React.createElement("th", { key: h }, h))
                        )
                      ),
                      React.createElement(
                        "tbody",
                        null,
                        filteredTransactions.map((t) =>
                          React.createElement(
                            "tr",
                            { key: t.id },
                            React.createElement("td", null, t.description),
                            React.createElement(
                              "td",
                              null,
                              t.amount.toFixed(2) + " ₪"
                            ),
                            React.createElement("td", null, t.type),
                            React.createElement("td", null, t.category),
                            React.createElement(
                              "td",
                              null,
                              new Date(t.date).toLocaleDateString("he-IL")
                            ),
                            React.createElement(
                              "td",
                              null,
                              React.createElement(
                                "button",
                                {
                                  onClick: () => openEditModal(t),
                                  className: "btn btn-link text-primary me-2",
                                },
                                "ערוך"
                              ),
                              React.createElement(
                                "button",
                                {
                                  onClick: () => deleteTransaction(t.id),
                                  className: "btn btn-link text-danger",
                                },
                                "מחק"
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            ),
          state.activeTab === "savings" &&
            React.createElement(
              React.Fragment,
              null,
              CollapsibleCard({
                title: "הוספת חיסכון",
                id: "savingsFormCollapse",
                children: React.createElement(
                  React.Fragment,
                  null,
                  state.savingsError &&
                    React.createElement(
                      "p",
                      { className: "text-danger mb-3" },
                      state.savingsError
                    ),
                  React.createElement(
                    "div",
                    { className: "row g-3" },
                    React.createElement(
                      "div",
                      { className: "col-md-4" },
                      FormField({
                        type: "text",
                        placeholder: "שם החיסכון",
                        value: state.savingsName,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            savingsName: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-4" },
                      FormField({
                        type: "number",
                        placeholder: "סכום",
                        value: state.savingsAmount,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            savingsAmount: e.target.value,
                          })),
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-md-4" },
                      FormField({
                        isSelect: true,
                        value: state.savingsLocation,
                        onChange: (e) =>
                          setState((s) => ({
                            ...s,
                            savingsLocation: e.target.value,
                          })),
                        options: predefinedLocations,
                        placeholder: "בחר מיקום",
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "col-12" },
                      React.createElement(
                        "button",
                        {
                          onClick: addSavings,
                          className: "btn btn-primary w-100",
                        },
                        "הוסף חיסכון"
                      )
                    )
                  )
                ),
              }),
              CollapsibleCard({
                title: "גרף חסכונות",
                id: "savingsChartCollapse",
                children: state.savings.length
                  ? React.createElement("canvas", { ref: savingsChartRef })
                  : React.createElement(
                      "div",
                      { className: "text-center text-muted" },
                      "אין נתונים להצגה"
                    ),
              }),
              CollapsibleCard({
                title: "רשימת חסכונות",
                id: "savingsTableCollapse",
                children: React.createElement(
                  "div",
                  { className: "table-responsive" },
                  React.createElement(
                    "table",
                    { className: "table table-bordered" },
                    React.createElement(
                      "thead",
                      null,
                      React.createElement(
                        "tr",
                        null,
                        ["שם החיסכון", "סכום", "מיקום", "תאריך", "פעולות"].map(
                          (h) => React.createElement("th", { key: h }, h)
                        )
                      )
                    ),
                    React.createElement(
                      "tbody",
                      null,
                      state.savings.map((s) =>
                        React.createElement(
                          "tr",
                          { key: s.id },
                          React.createElement("td", null, s.name),
                          React.createElement(
                            "td",
                            null,
                            s.amount.toFixed(2) + " ₪"
                          ),
                          React.createElement("td", null, s.location),
                          React.createElement(
                            "td",
                            null,
                            new Date(s.date).toLocaleDateString("he-IL")
                          ),
                          React.createElement(
                            "td",
                            null,
                            React.createElement(
                              "button",
                              {
                                onClick: () => deleteSavings(s.id),
                                className: "btn btn-link text-danger",
                              },
                              "מחק"
                            )
                          )
                        )
                      )
                    )
                  )
                ),
              })
            ),
          state.activeTab === "insights" &&
            CollapsibleCard({
              title: "תובנות פיננסיות",
              id: "insightsCollapse",
              children: React.createElement(
                "ul",
                { className: "insights-list" },
                generateInsights().map((insight, i) =>
                  React.createElement("li", { key: i }, insight)
                )
              ),
            }),
          state.activeTab === "about" &&
            CollapsibleCard({
              title: "אודות",
              id: "aboutCollapse",
              children: React.createElement(
                "div",
                { className: "text-center" },
                React.createElement(
                  "p",
                  null,
                  "Finely - ניהול פיננסי חכם לעקוב אחר הכנסות, הוצאות וחסכונות עם ממשק נוח וגרפים ברורים."
                ),
                React.createElement(
                  "p",
                  null,
                  "ברוכים הבאים ל-Finely! האפליקציה הזו נועדה לעזור לכם לנהל את הכספים שלכם בצורה פשוטה ויעילה. תוכלו לעקוב אחר ההכנסות וההוצאות שלכם, להגדיר חסכונות ולקבל תובנות פיננסיות שיעזרו לכם לקבל החלטות מושכלות. האפליקציה פותחה ללא מטרות רווח, במטרה לסייע לכל אדם לנהל את כספיו בצורה נגישה ויעילה. התחילו עכשיו וקחו שליטה על העתיד הפיננסי שלכם!"
                )
              ),
            }),
          React.createElement(
            "div",
            { className: "footer" },
            "© 2025 Finely. כל הזכויות שמורות."
          )
        );
      };
      ReactDOM.render(
        React.createElement(FinanceApp),
        document.getElementById("root")
      );
    </script>
  </body>
</html>
